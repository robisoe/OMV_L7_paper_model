% run in matlab R2022A or later; % Instruction:% 1. Place all files in the same folder, % 2. Set the Current Folder toolbar to where the files are, % 3. Press the run button.%% used in:% Closed-loop optogenetic perturbation of macaque oculomotor cerebellum: evidence for an internal saccade model% Soetedjo, R and Horwitz G.D.%% Initialize variables, weightstauOPN=0.002;tauEBN=0.002;opnThresholdBias=50;wIntPlant=0.76 * 1.30;wEbnPlant=0.08 * 1.30;wSlidePlant=0.084 * 1.30;wErrorRate=80;MaxEBNfr = 1000;wIbnOpn=1.5;wOpnEbn=32;wFbintLlbn=1;% contrastim% stim time base : 0.049; start with rate 450contrastimrate = 000;contrastimdur = 0.01;contrapulset0 = 0.049;contrapulset1 = contrapulset0 + contrastimdur;% ipsistim% start with rate = 450ipsistimrate = 000;ipsistimdur = 0.01;ipsipulset0 = 0.049;ipsipulset1 = ipsipulset0 + ipsistimdur;sacstart = 0.0426; % in second% do control (80)MaxEBNfr = 1000;sim('paper_model_20230707');poscontrol = pos;velcontrol = vel;dmecontrol = dme;% do control slow (60)MaxEBNfr = 750;sim('paper_model_20230707');poscontrolslow = pos;velcontrolslow = vel;dmecontrolslow = dme;% do contra stim 0 (80)MaxEBNfr = 1000;contrastimrate = 450;contrastimdur = 0.01;contrapulset0 = 0.049; % sacstart@0.0426, so stim onset=0.0064 (6.4 ms) after saccade onsetcontrapulset1 = contrapulset0 + contrastimdur;sim('paper_model_20230707');poscontra0 = pos;velcontra0 = vel;dmecontra0 = dme;% contra stim 20 (80)MaxEBNfr = 1000;contrastimrate = 450;contrastimdur = 0.01;contrapulset0 = 0.069; % sacstart@0.0426, so stim onset=0.0264 (26.4 ms) after saccade onsetcontrapulset1 = contrapulset0 + contrastimdur;sim('paper_model_20230707');poscontra20 = pos;velcontra20 = vel;dmecontra20 = dme;% contra stim 20 slow (60)MaxEBNfr = 750;contrastimrate = 450;contrastimdur = 0.01;contrapulset0 = 0.069;contrapulset1 = contrapulset0 + contrastimdur;sim('paper_model_20230707');poscontra20slow = pos;velcontra20slow = vel;dmecontra20slow = dme;% contra stim 0 slow (60)MaxEBNfr = 750;contrastimrate = 450;contrastimdur = 0.01;contrapulset0 = 0.049;contrapulset1 = contrapulset0 + contrastimdur;sim('paper_model_20230707');poscontra0slow = pos;velcontra0slow = vel;dmecontra0slow = dme;contrastimrate = 0;wErrorRate=80;MaxEBNfr = 1000;% do ipsi stimipsistimrate = 450;ipsistimdur = 0.01;ipsipulset0 = 0.049;ipsipulset1 = ipsipulset0 + ipsistimdur;sim('paper_model_20230707');posipsi0 = pos;velipsi0 = vel;dmeipsi0 = dme;ipsistimrate = 450;ipsistimdur = 0.01;ipsipulset0 = 0.069;ipsipulset1 = ipsipulset0 + ipsistimdur;sim('paper_model_20230707');posipsi20 = pos;velipsi20 = vel;dmeipsi20 = dme;ipsistimrate = 0;% do mix 0MaxEBNfr = 1000;% contrastim% stim time base : 0.049; start with rate 450contrastimrate = 450;contrastimdur = 0.01;contrapulset0 = 0.049;contrapulset1 = contrapulset0 + contrastimdur;% ipsistim% start with rate = 450ipsistimrate = 450;ipsistimdur = 0.01;ipsipulset0 = 0.049;ipsipulset1 = ipsipulset0 + ipsistimdur;sim('paper_model_20230707');posmix0 = pos;velmix0 = vel;dmemix0 = dme;% do mix 20% contrastim% stim time base : 0.049; start with rate 450contrastimrate = 450;contrastimdur = 0.01;contrapulset0 = 0.069;contrapulset1 = contrapulset0 + contrastimdur;% ipsistim% start with rate = 450ipsistimrate = 450;ipsistimdur = 0.01;ipsipulset0 = 0.069;ipsipulset1 = ipsipulset0 + ipsistimdur;sim('paper_model_20230707');posmix20 = pos;velmix20 = vel;dmemix20 = dme;%donecontrastimrate = 0;ipsistimrate = 0;% prepare figurebluecolor = [0 128 255]/256;figh = figure();set(figh,'position',[77.8, 755.4, 2033.6, 760])tsim = (t-sacstart)*1000; % in ms% IPSIsubplot(2,4,1); hold on; set(gca,'xlim',[-20 120],'ylim',[-2 30]);set(gca,'xtick',[0:20:120],'ytick',[0:4:28],'Linewidth',1,'Fontsize',15);plot(tsim,poscontrol,'-k','Linewidth',1.5)plot(tsim,posipsi0,'-r','Linewidth',1.5)plot(tsim,posipsi20,'-','color',bluecolor,'Linewidth',1.5)plot([0 10]+6.4,[-1 -1],'r-','LineWidth',3)plot([0 10]+26.4,[-1 -1],'-','color',bluecolor, 'LineWidth',3)ylabel('Position (deg)');title('Ipsi Activation')subplot(2,4,5); hold on; set(gca,'xlim',[-20 120],'ylim',[-50 800]);set(gca,'xtick',[0:20:120],'ytick',[0:200:800],'Linewidth',1,'Fontsize',15);plot(tsim,velcontrol,'-k','Linewidth',1.5)plot(tsim,velipsi0,'-r','Linewidth',1.5)plot(tsim,velipsi20,'-','color',bluecolor,'Linewidth',1.5)plot([0 10]+6.4,[-1 -1],'r-','LineWidth',3)plot([0 10]+26.4,[-1 -1],'-','color',bluecolor, 'LineWidth',3)ylabel('Velocity (deg/s)');xlabel('Time after saccade onset (ms)')% CONTRA FASTsubplot(2,4,2); hold on; set(gca,'xlim',[-20 120],'ylim',[-2 30]);set(gca,'xtick',[0:20:120],'ytick',[0:4:28],'Linewidth',1,'Fontsize',15);plot(tsim,poscontrol,'-k','Linewidth',1.5)plot(tsim,poscontra0,'-r','Linewidth',1.5)plot(tsim,poscontra20,'-','color',bluecolor,'Linewidth',1.5)plot([0 10]+6.4,[-1 -1],'r-','LineWidth',3)plot([0 10]+26.4,[-1 -1],'-','color',bluecolor, 'LineWidth',3)title('Contra Activation')subplot(2,4,6); hold on; set(gca,'xlim',[-20 120],'ylim',[-50 800]);set(gca,'xtick',[0:20:120],'ytick',[0:200:800],'Linewidth',1,'Fontsize',15);plot(tsim,velcontrol,'-k','Linewidth',1.5)plot(tsim,velcontra0,'-r','Linewidth',1.5)plot(tsim,velcontra20,'-','color',bluecolor,'Linewidth',1.5)plot([0 10]+6.4,[-1 -1],'r-','LineWidth',3)plot([0 10]+26.4,[-1 -1],'-','color',bluecolor, 'LineWidth',3)% CONTRA SLOWsubplot(2,4,3); hold on; set(gca,'xlim',[-20 120],'ylim',[-2 30]);set(gca,'xtick',[0:20:120],'ytick',[0:4:28],'Linewidth',1,'Fontsize',15);plot(tsim,poscontrolslow,'-k','Linewidth',1.5)plot(tsim,poscontra0slow,'-r','Linewidth',1.5)plot(tsim,poscontra20slow,'-','color',bluecolor,'Linewidth',1.5)plot([0 10]+6.4,[-1 -1],'r-','LineWidth',3)plot([0 10]+26.4,[-1 -1],'-','color',bluecolor, 'LineWidth',3)title('Contra Activation, Slow Saccades')subplot(2,4,7); hold on; set(gca,'xlim',[-20 120],'ylim',[-50 800]);set(gca,'xtick',[0:20:120],'ytick',[0:200:800],'Linewidth',1,'Fontsize',15);plot(tsim,velcontrolslow,'-k','Linewidth',1.5)plot(tsim,velcontra0slow,'-r','Linewidth',1.5)plot(tsim,velcontra20slow,'-','color',bluecolor,'Linewidth',1.5)plot([0 10]+6.4,[-1 -1],'r-','LineWidth',3)plot([0 10]+26.4,[-1 -1],'-','color',bluecolor, 'LineWidth',3)% MIX (midline sim)subplot(2,4,4); hold on; set(gca,'xlim',[-20 120],'ylim',[-2 30]);set(gca,'xtick',[0:20:120],'ytick',[0:4:28],'Linewidth',1,'Fontsize',15);plot(tsim,poscontrol,'-k','Linewidth',1.5)plot(tsim,posmix0,'-r','Linewidth',1.5)plot(tsim,posmix20,'-','color',bluecolor,'Linewidth',1.5)plot([0 10]+6.4,[-1 -1],'r-','LineWidth',3)plot([0 10]+26.4,[-1 -1],'-','color',bluecolor, 'LineWidth',3)title('Ipsi-Contra Simultaneous Activation')subplot(2,4,8); hold on; set(gca,'xlim',[-20 120],'ylim',[-50 800]);set(gca,'xtick',[0:20:120],'ytick',[0:200:800],'Linewidth',1,'Fontsize',15);plot(tsim,velcontrol,'-k','Linewidth',1.5)plot(tsim,velmix0,'-r','Linewidth',1.5)plot(tsim,velmix20,'-','color',bluecolor,'Linewidth',1.5)plot([0 10]+6.4,[-1 -1],'r-','LineWidth',3)plot([0 10]+26.4,[-1 -1],'-','color',bluecolor, 'LineWidth',3)